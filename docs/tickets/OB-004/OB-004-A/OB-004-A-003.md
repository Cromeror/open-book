# OB-004-A-003: Validar reglas de negocio de objetivos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-004 - Objetivos de Recaudo |
| Story | OB-004-A - Modelo y CRUD de objetivos |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, validacion, negocio |
| Depends on | OB-004-A-002 |
| Assigned | unassigned |

## Descripcion

Implementar validaciones de reglas de negocio especificas para objetivos de recaudo que van mas alla de la validacion de tipos de datos.

## Contexto Tecnico

### Archivos afectados
- `src/services/objetivo.service.ts`
- `src/api/validators/objetivo.validator.ts`

### Enfoque tecnico
Validaciones en capa de servicio para reglas de negocio complejas. Validaciones en validators para datos de entrada.

## Criterios de Aceptacion

- [ ] Monto objetivo debe ser mayor a 0
- [ ] Fecha fin debe ser >= fecha inicio (si se proporciona)
- [ ] No se puede eliminar objetivo con actividades asociadas
- [ ] No se puede eliminar objetivo con aportes registrados
- [ ] No se puede modificar monto de objetivo finalizado
- [ ] Mensajes de error claros para cada validacion

## Notas de Implementacion

Validaciones de entrada (zod):
```typescript
const createObjetivoSchema = z.object({
  nombre: z.string().min(3).max(200),
  descripcion: z.string().max(1000).optional(),
  montoObjetivo: z.number().positive('El monto debe ser mayor a 0'),
  fechaInicio: z.coerce.date(),
  fechaFin: z.coerce.date().optional()
}).refine(
  data => !data.fechaFin || data.fechaFin >= data.fechaInicio,
  { message: 'La fecha fin debe ser posterior a la fecha inicio' }
);
```

Validaciones de negocio:
```typescript
async function canDeleteObjetivo(objetivoId: string): Promise<void> {
  const actividades = await typeorm.actividad.count({
    where: { objetivoId }
  });
  if (actividades > 0) {
    throw new BusinessError(
      'No se puede eliminar un objetivo con actividades asociadas'
    );
  }
}
```

## Testing

- [ ] Monto 0 o negativo es rechazado
- [ ] Fecha fin anterior a inicio es rechazada
- [ ] Objetivo con actividades no se puede eliminar
- [ ] Objetivo finalizado no permite cambiar monto
