# OB-004-C-002: Mostrar resumen de objetivo con progreso

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-004 - Objetivos de Recaudo |
| Story | OB-004-C - Visualizacion de objetivos para residentes |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, progreso, resumen |
| Depends on | OB-004-C-001 |
| Assigned | unassigned |

## Descripcion

Enriquecer la informacion de objetivos con datos de progreso agregados, mostrando cuanto se ha recaudado sin revelar detalles individuales de otros apartamentos.

## Contexto Tecnico

### Archivos afectados
- `src/services/objetivo.service.ts`
- `src/services/calculo.service.ts`

### Enfoque tecnico
Agregar campos calculados al response: total recaudado, porcentaje de avance, faltante.

## Criterios de Aceptacion

- [ ] Response incluye totalRecaudado
- [ ] Response incluye porcentajeAvance
- [ ] Response incluye montoFaltante
- [ ] Los calculos son en tiempo real o con cache corto
- [ ] No se muestran detalles de aportes individuales

## Notas de Implementacion

Response enriquecido:
```json
{
  "id": "uuid",
  "nombre": "Reparacion ascensores",
  "montoObjetivo": "15000000.00",
  "estado": "ACTIVO",
  "progreso": {
    "totalRecaudado": "8250000.00",
    "porcentajeAvance": 55.0,
    "montoFaltante": "6750000.00"
  },
  "fechaInicio": "2025-02-01",
  "fechaFin": "2025-06-30"
}
```

Calculo:
```typescript
async function calcularProgresoObjetivo(objetivoId: string) {
  const objetivo = await typeorm.objetivo.findUnique({
    where: { id: objetivoId }
  });

  const totalRecaudado = await typeorm.aporte.aggregate({
    where: {
      actividad: { objetivoId },
      estado: 'CONFIRMADO'
    },
    _sum: { monto: true }
  });

  const recaudado = totalRecaudado._sum.monto || 0;
  const porcentaje = (recaudado / objetivo.montoObjetivo) * 100;

  return {
    totalRecaudado: recaudado,
    porcentajeAvance: Math.min(porcentaje, 100),
    montoFaltante: Math.max(objetivo.montoObjetivo - recaudado, 0)
  };
}
```

## Testing

- [ ] Progreso se calcula correctamente
- [ ] Porcentaje no excede 100%
- [ ] Faltante no es negativo
- [ ] Solo suma aportes confirmados
