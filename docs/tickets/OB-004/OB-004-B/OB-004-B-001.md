# OB-004-B-001: Definir maquina de estados de objetivo

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-004 - Objetivos de Recaudo |
| Story | OB-004-B - Estados y ciclo de vida de objetivos |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, estados, maquina-estados |
| Depends on | OB-004-A-001 |
| Assigned | unassigned |

## Descripcion

Definir formalmente los estados posibles de un objetivo y las transiciones validas entre ellos, implementando una maquina de estados.

## Contexto Tecnico

### Archivos afectados
- `src/domain/objetivo-state-machine.ts`
- `src/types/objetivo.ts`

### Enfoque tecnico
Implementar patron State Machine con validacion de transiciones. Cada transicion puede tener condiciones adicionales.

## Criterios de Aceptacion

- [ ] Estados definidos con descripcion clara
- [ ] Matriz de transiciones implementada
- [ ] Funcion canTransition(from, to) implementada
- [ ] Funcion transition(objetivo, newState) implementada
- [ ] Transiciones invalidas lanzan error descriptivo

## Notas de Implementacion

Estados y transiciones:
```
ACTIVO
  -> PAUSADO (requiere justificacion)
  -> FINALIZADO (cuando se alcanza objetivo o decide cerrar)
  -> CANCELADO (requiere justificacion)

PAUSADO
  -> ACTIVO (reanudar)
  -> CANCELADO (requiere justificacion)

FINALIZADO
  -> (terminal, no hay transiciones)

CANCELADO
  -> (terminal, no hay transiciones)
```

```typescript
const TRANSITIONS: Record<EstadoObjetivo, EstadoObjetivo[]> = {
  ACTIVO: ['PAUSADO', 'FINALIZADO', 'CANCELADO'],
  PAUSADO: ['ACTIVO', 'CANCELADO'],
  FINALIZADO: [],
  CANCELADO: []
};

interface TransitionConfig {
  requiresJustification: boolean;
  validations?: ((objetivo: Objetivo) => Promise<void>)[];
}

function canTransition(from: EstadoObjetivo, to: EstadoObjetivo): boolean {
  return TRANSITIONS[from].includes(to);
}
```

## Testing

- [ ] Transiciones validas son aceptadas
- [ ] Transiciones invalidas son rechazadas
- [ ] Estados terminales no permiten transiciones
- [ ] La configuracion cubre todos los estados
