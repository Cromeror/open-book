# OB-003-C-002: Implementar endpoints de asociacion

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-C - Asociacion de usuarios a apartamentos |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, asociacion |
| Depends on | OB-003-C-001 |
| Assigned | unassigned |

## Descripcion

Implementar endpoints para que administradores puedan asociar y desasociar residentes a apartamentos, y gestionar solicitudes pendientes.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/apartamentos.routes.ts`
- `src/api/controllers/apartamentos.controller.ts`
- `src/services/apartamento-residente.service.ts`

### Enfoque tecnico
Endpoints anidados bajo apartamento. Gestion de estados de asociacion.

## Criterios de Aceptacion

- [ ] POST /api/.../apartamentos/:id/residentes - Asociar
- [ ] GET /api/.../apartamentos/:id/residentes - Listar
- [ ] PATCH /api/.../apartamentos/:id/residentes/:id - Actualizar
- [ ] DELETE /api/.../apartamentos/:id/residentes/:id - Desasociar
- [ ] PUT /api/.../apartamentos/:id/residentes/:id/approve - Aprobar
- [ ] Solo admins pueden gestionar

## Notas de Implementacion

Asociar residente:
```
POST /api/copropiedades/:copId/apartamentos/:aptId/residentes
Body: {
  "userId": "uuid",
  "tipoRelacion": "PROPIETARIO",
  "isPrimary": true
}
```

Aprobar solicitud:
```
PUT /api/copropiedades/:copId/apartamentos/:aptId/residentes/:id/approve
```

Listar residentes:
```
GET /api/copropiedades/:copId/apartamentos/:aptId/residentes?estado=ACTIVE
Response: {
  "data": [
    {
      "id": "uuid",
      "user": { "id": "...", "firstName": "Juan", "email": "..." },
      "tipoRelacion": "PROPIETARIO",
      "estado": "ACTIVE",
      "isPrimary": true
    }
  ]
}
```

## Testing

- [ ] Admin puede asociar residente
- [ ] No-admin recibe 403
- [ ] Aprobar cambia estado a ACTIVE
- [ ] Desasociar cambia estado a INACTIVE
