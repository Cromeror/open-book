# OB-003-C-002: Implementar endpoints de asociacion

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-C - Asociacion de usuarios a apartamentos |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, asociacion |
| Depends on | OB-003-C-001 |
| Assigned | unassigned |

## Descripcion

Implementar endpoints para que administradores puedan asociar y desasociar residentes a apartamentos, y gestionar solicitudes pendientes.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/apartments.routes.ts`
- `src/api/controllers/apartments.controller.ts`
- `src/services/apartment-resident.service.ts`

### Enfoque tecnico
Endpoints anidados bajo apartamento. Gestion de estados de asociacion.

## Criterios de Aceptacion

- [ ] POST /api/.../apartments/:id/residents - Asociar
- [ ] GET /api/.../apartments/:id/residents - Listar
- [ ] PATCH /api/.../apartments/:id/residents/:id - Actualizar
- [ ] DELETE /api/.../apartments/:id/residents/:id - Desasociar
- [ ] PUT /api/.../apartments/:id/residents/:id/approve - Aprobar
- [ ] Solo admins pueden gestionar

## Notas de Implementacion

Asociar residente:
```
POST /api/condominiums/:condoId/apartments/:aptId/residents
Body: {
  "userId": "uuid",
  "relationType": "OWNER",
  "isPrimary": true
}
```

Aprobar solicitud:
```
PUT /api/condominiums/:condoId/apartments/:aptId/residents/:id/approve
```

Listar residentes:
```
GET /api/condominiums/:condoId/apartments/:aptId/residents?status=ACTIVE
Response: {
  "data": [
    {
      "id": "uuid",
      "user": { "id": "...", "firstName": "Juan", "email": "..." },
      "relationType": "OWNER",
      "status": "ACTIVE",
      "isPrimary": true
    }
  ]
}
```

## Testing

- [ ] Admin puede asociar residente
- [ ] No-admin recibe 403
- [ ] Aprobar cambia estado a ACTIVE
- [ ] Desasociar cambia estado a INACTIVE
