# OB-003-C-001: Crear entidad ApartamentoResidente con TypeORM

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-C - Asociacion de usuarios a apartamentos |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, entidad, typeorm, relacion |
| Depends on | OB-003-B-001, OB-002-A-001 |
| Assigned | unassigned |

## Descripcion

Crear la entidad de relacion entre usuarios y apartamentos con TypeORM, permitiendo registrar el tipo de relacion (propietario, arrendatario) y mantener historial.

## Contexto Tecnico

### Archivos afectados
- `apps/api/src/entities/apartamento-residente.entity.ts`
- `apps/api/src/types/apartamento-residente.ts`

### Enfoque tecnico
Entidad de union con campos adicionales para tipo de relacion, estado y fechas de vigencia usando decoradores TypeORM.

## Criterios de Aceptacion

- [ ] Entidad ApartamentoResidente creada con TypeORM
- [ ] Campos: tipo de relacion (propietario/arrendatario)
- [ ] Estado de la asociacion (pending, active, inactive)
- [ ] Fechas de inicio y fin de vigencia
- [ ] Un usuario solo puede estar activo en un apartamento
- [ ] Hereda campos de auditoria de BaseEntity

## Notas de Implementacion

Entidad ApartamentoResidente con TypeORM:
```typescript
import { Entity, Column, ManyToOne, JoinColumn, Unique } from 'typeorm';
import { BaseEntity } from './base.entity';
import { Apartamento } from './apartamento.entity';
import { User } from './user.entity';

export enum TipoRelacion {
  PROPIETARIO = 'PROPIETARIO',
  ARRENDATARIO = 'ARRENDATARIO',
  OTRO = 'OTRO',
}

export enum EstadoAsociacion {
  PENDING = 'PENDING',
  ACTIVE = 'ACTIVE',
  INACTIVE = 'INACTIVE',
  REJECTED = 'REJECTED',
}

@Entity('apartamento_residentes')
@Unique(['apartamentoId', 'userId', 'estado'])
export class ApartamentoResidente extends BaseEntity {
  @Column()
  apartamentoId: string;

  @ManyToOne(() => Apartamento, (apt) => apt.residentes)
  @JoinColumn({ name: 'apartamentoId' })
  apartamento: Apartamento;

  @Column()
  userId: string;

  @ManyToOne(() => User)
  @JoinColumn({ name: 'userId' })
  user: User;

  @Column({
    type: 'enum',
    enum: TipoRelacion,
  })
  tipoRelacion: TipoRelacion;

  @Column({
    type: 'enum',
    enum: EstadoAsociacion,
    default: EstadoAsociacion.PENDING,
  })
  estado: EstadoAsociacion;

  @Column({ type: 'timestamp', nullable: true })
  fechaInicio: Date;

  @Column({ type: 'timestamp', nullable: true })
  fechaFin: Date;

  @Column({ default: false })
  isPrimary: boolean; // Contacto principal

  @Column({ nullable: true })
  approvedBy: string;

  @Column({ type: 'timestamp', nullable: true })
  approvedAt: Date;
}
```

## Testing

- [ ] Entidad se crea correctamente
- [ ] Constraint de unicidad funciona
- [ ] Estados se manejan correctamente
- [ ] Relaciones con User y Apartamento funcionan
