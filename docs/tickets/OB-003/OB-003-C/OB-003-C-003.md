# OB-003-C-003: Permitir auto-registro de residentes

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-C - Asociacion de usuarios a apartamentos |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, auto-registro |
| Depends on | OB-003-C-002 |
| Assigned | unassigned |

## Descripcion

Permitir que residentes registrados soliciten asociarse a un apartamento especifico. La solicitud queda pendiente hasta que un administrador la apruebe.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/residentes.routes.ts`
- `src/api/controllers/residentes.controller.ts`
- `src/services/apartamento-residente.service.ts`

### Enfoque tecnico
Endpoint para que el usuario solicite asociacion. Crear registro en estado PENDING. Notificar a admins.

## Criterios de Aceptacion

- [ ] POST /api/solicitar-apartamento - Crear solicitud
- [ ] Residente selecciona copropiedad y apartamento
- [ ] Solicitud queda en estado PENDING
- [ ] Admin recibe notificacion de solicitud pendiente
- [ ] Residente puede ver estado de su solicitud
- [ ] Residente puede cancelar solicitud pendiente

## Notas de Implementacion

Solicitar asociacion:
```
POST /api/solicitar-apartamento
Authorization: Bearer <token-residente>
Body: {
  "copropiedadId": "uuid",
  "apartamentoId": "uuid",
  "tipoRelacion": "ARRENDATARIO"
}
```

Response:
```json
{
  "id": "uuid",
  "estado": "PENDING",
  "apartamento": {
    "numero": "101",
    "torre": "Torre A"
  },
  "message": "Solicitud enviada. Un administrador la revisara."
}
```

Ver mis solicitudes:
```
GET /api/mis-solicitudes-apartamento
```

Consideraciones:
- Evitar spam: limite de solicitudes pendientes por usuario
- No revelar informacion sensible de otros residentes

## Testing

- [ ] Residente puede crear solicitud
- [ ] Solicitud queda en estado PENDING
- [ ] No puede crear duplicados
- [ ] Puede cancelar solicitud pendiente
- [ ] Admin ve solicitudes pendientes
