# OB-003-C-003: Permitir auto-registro de residentes

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-C - Asociacion de usuarios a apartamentos |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, auto-registro |
| Depends on | OB-003-C-002 |
| Assigned | unassigned |

## Descripcion

Permitir que residentes registrados soliciten asociarse a un apartamento especifico. La solicitud queda pendiente hasta que un administrador la apruebe.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/residents.routes.ts`
- `src/api/controllers/residents.controller.ts`
- `src/services/apartment-resident.service.ts`

### Enfoque tecnico
Endpoint para que el usuario solicite asociacion. Crear registro en estado PENDING. Notificar a admins.

## Criterios de Aceptacion

- [ ] POST /api/request-apartment - Crear solicitud
- [ ] Residente selecciona copropiedad y apartamento
- [ ] Solicitud queda en estado PENDING
- [ ] Admin recibe notificacion de solicitud pendiente
- [ ] Residente puede ver estado de su solicitud
- [ ] Residente puede cancelar solicitud pendiente

## Notas de Implementacion

Solicitar asociacion:
```
POST /api/request-apartment
Authorization: Bearer <token-resident>
Body: {
  "condominiumId": "uuid",
  "apartmentId": "uuid",
  "relationType": "TENANT"
}
```

Response:
```json
{
  "id": "uuid",
  "status": "PENDING",
  "apartment": {
    "number": "101",
    "tower": "Tower A"
  },
  "message": "Solicitud enviada. Un administrador la revisara."
}
```

Ver mis solicitudes:
```
GET /api/my-apartment-requests
```

Consideraciones:
- Evitar spam: limite de solicitudes pendientes por usuario
- No revelar informacion sensible de otros residentes

## Testing

- [ ] Residente puede crear solicitud
- [ ] Solicitud queda en estado PENDING
- [ ] No puede crear duplicados
- [ ] Puede cancelar solicitud pendiente
- [ ] Admin ve solicitudes pendientes
