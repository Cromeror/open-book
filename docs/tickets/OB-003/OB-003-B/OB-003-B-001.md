# OB-003-B-001: Crear entidad Apartamento con TypeORM

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-B - Modelo y gestion de apartamentos |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, entidad, typeorm, apartamento |
| Depends on | OB-003-A-001 |
| Assigned | unassigned |

## Descripcion

Crear la entidad Apartamento con decoradores TypeORM segun la seccion 4.3 del SUMMARY.md: numero de apartamento, torre/bloque, y estado.

## Contexto Tecnico

### Archivos afectados
- `apps/api/src/entities/apartamento.entity.ts`
- `apps/api/src/types/apartamento.ts`

### Enfoque tecnico
Entidad con relaciones a Copropiedad y Torre (opcional) usando decoradores TypeORM. Indice unico compuesto para evitar duplicados.

## Criterios de Aceptacion

- [ ] Entidad Apartamento creada con decoradores TypeORM
- [ ] Campos: numero, piso (opcional), torreId (opcional)
- [ ] Relacion con Copropiedad (requerida)
- [ ] Relacion con Torre (opcional)
- [ ] Campo isActive para estado
- [ ] Indice unico: (copropiedadId, torreId, numero)
- [ ] Hereda campos de auditoria de BaseEntity

## Notas de Implementacion

Entidad Apartamento con TypeORM:
```typescript
import { Entity, Column, ManyToOne, OneToMany, JoinColumn, Unique, Index } from 'typeorm';
import { BaseEntity } from './base.entity';
import { Copropiedad } from './copropiedad.entity';
import { Torre } from './torre.entity';
import { ApartamentoResidente } from './apartamento-residente.entity';
import { Compromiso } from './compromiso.entity';
import { Aporte } from './aporte.entity';

@Entity('apartamentos')
@Unique(['copropiedadId', 'torreId', 'numero'])
export class Apartamento extends BaseEntity {
  @Column()
  numero: string;

  @Column({ nullable: true })
  piso: number;

  @Column()
  @Index()
  copropiedadId: string;

  @ManyToOne(() => Copropiedad, (cop) => cop.apartamentos)
  @JoinColumn({ name: 'copropiedadId' })
  copropiedad: Copropiedad;

  @Column({ nullable: true })
  torreId: string;

  @ManyToOne(() => Torre, (torre) => torre.apartamentos, { nullable: true })
  @JoinColumn({ name: 'torreId' })
  torre: Torre;

  @Column({ default: true })
  isActive: boolean;

  // Relaciones
  @OneToMany(() => ApartamentoResidente, (ar) => ar.apartamento)
  residentes: ApartamentoResidente[];

  @OneToMany(() => Compromiso, (c) => c.apartamento)
  compromisos: Compromiso[];

  @OneToMany(() => Aporte, (a) => a.apartamento)
  aportes: Aporte[];
}
```

## Testing

- [ ] Migracion se aplica sin errores
- [ ] Se puede crear apartamento sin torre
- [ ] Se puede crear apartamento con torre
- [ ] Duplicado en misma copropiedad/torre falla
