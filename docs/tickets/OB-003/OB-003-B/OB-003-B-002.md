# OB-003-B-002: Implementar CRUD de apartamentos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-B - Modelo y gestion de apartamentos |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, crud, apartamento |
| Depends on | OB-003-B-001 |
| Assigned | unassigned |

## Descripcion

Implementar endpoints REST para el CRUD de apartamentos, anidados bajo la copropiedad correspondiente.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/apartamentos.routes.ts`
- `src/api/controllers/apartamentos.controller.ts`
- `src/services/apartamento.service.ts`
- `src/api/validators/apartamento.validator.ts`

### Enfoque tecnico
Endpoints anidados bajo copropiedad. Solo admins de la copropiedad pueden gestionar.

## Criterios de Aceptacion

- [ ] POST /api/copropiedades/:copId/apartamentos
- [ ] GET /api/copropiedades/:copId/apartamentos
- [ ] GET /api/copropiedades/:copId/apartamentos/:id
- [ ] PATCH /api/copropiedades/:copId/apartamentos/:id
- [ ] DELETE /api/copropiedades/:copId/apartamentos/:id
- [ ] Filtros: por torre, por estado, por piso
- [ ] Solo admins de la copropiedad tienen acceso

## Notas de Implementacion

Crear apartamento:
```
POST /api/copropiedades/:copId/apartamentos
Body: {
  "numero": "101",
  "piso": 1,
  "torreId": "uuid-torre" // opcional
}
```

Listar con filtros:
```
GET /api/copropiedades/:copId/apartamentos?torre=uuid&piso=1&active=true
```

Response:
```json
{
  "data": [
    {
      "id": "uuid",
      "numero": "101",
      "piso": 1,
      "torre": { "id": "uuid", "nombre": "Torre A" },
      "isActive": true
    }
  ],
  "total": 50,
  "page": 1,
  "limit": 20
}
```

## Testing

- [ ] CRUD funciona correctamente
- [ ] Filtros funcionan
- [ ] Admin de otra copropiedad no tiene acceso
- [ ] Validacion de datos funciona
