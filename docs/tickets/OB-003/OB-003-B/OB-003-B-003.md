# OB-003-B-003: Implementar carga masiva de apartamentos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-B - Modelo y gestion de apartamentos |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, importacion, csv |
| Depends on | OB-003-B-002 |
| Assigned | unassigned |

## Descripcion

Implementar funcionalidad para cargar multiples apartamentos desde un archivo CSV, facilitando la configuracion inicial de copropiedades grandes.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/apartments.routes.ts`
- `src/api/controllers/apartments.controller.ts`
- `src/services/apartment.service.ts`
- `src/utils/csv-parser.ts`

### Enfoque tecnico
Endpoint que acepta archivo CSV, parsea, valida y crea apartamentos en una transaccion.

## Criterios de Aceptacion

- [ ] Endpoint POST /api/condominiums/:id/apartments/bulk
- [ ] Acepta archivo CSV con columnas: numero, piso, torre
- [ ] Valida todos los registros antes de insertar
- [ ] Inserta en transaccion (todo o nada)
- [ ] Retorna resumen: creados, errores, duplicados
- [ ] Template CSV descargable

## Notas de Implementacion

Formato CSV:
```csv
numero,piso,torre
101,1,Torre A
102,1,Torre A
201,2,Torre A
101,1,Torre B
```

Request:
```
POST /api/condominiums/:id/apartments/bulk
Content-Type: multipart/form-data
file: archivo.csv
```

Response:
```json
{
  "total": 100,
  "created": 95,
  "errors": [
    { "row": 45, "numero": "101", "error": "Duplicado" },
    { "row": 67, "numero": "abc", "error": "Numero invalido" }
  ]
}
```

Template endpoint:
```
GET /api/condominiums/:id/apartments/template
Response: archivo CSV de ejemplo
```

## Testing

- [ ] Carga exitosa crea apartamentos
- [ ] Errores de validacion se reportan por fila
- [ ] Duplicados se detectan
- [ ] Transaccion: si hay error critico, no se crea nada
