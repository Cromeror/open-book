# OB-003-A-001: Crear entidad Condominium con TypeORM

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-003 - Gestion de Copropiedades y Apartamentos |
| Story | OB-003-A - Modelo y gestion de copropiedades |
| Status | done |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2026-01-09 |
| Labels | task, entidad, typeorm, copropiedad |
| Depends on | OB-001-B-003 |
| Assigned | - |

## Descripcion

Crear la entidad Condominium con decoradores TypeORM incluyendo todos los campos necesarios para representar una unidad residencial, heredando campos de auditoria de BaseEntity.

## Contexto Tecnico

### Archivos implementados
- `apps/api/src/entities/condominium.entity.ts` - Entidad principal (COMPLETADO)
- `apps/api/src/migrations/1736267000000-CreateGoalsTable.ts` - Migracion incluye tabla condominiums

### Archivos pendientes (otras tareas)
- `apps/api/src/entities/tower.entity.ts` - Ver OB-003-A-004
- `apps/api/src/entities/condominium-admin.entity.ts` - Ver OB-003-A-003

## Criterios de Aceptacion

- [x] Entidad Condominium creada con decoradores TypeORM
- [x] Campos de identificacion: name, nit (opcional con unique constraint condicional)
- [x] Campos de ubicacion: address, city
- [x] Campo de configuracion: unitCount
- [x] Campo isActive para soft delete
- [x] Hereda campos de auditoria de BaseEntity
- [x] Migracion creada y aplicada

## Implementacion Real

La entidad fue implementada con nombrado en ingles segun convenciones del proyecto:

```typescript
// apps/api/src/entities/condominium.entity.ts
import { Entity, Column, OneToMany, Index } from 'typeorm';
import { BaseEntity } from './base.entity';

@Entity('condominiums')
export class Condominium extends BaseEntity {
  @Column({ type: 'varchar', length: 200 })
  name!: string;

  @Index('idx_condominiums_nit', { unique: true, where: 'nit IS NOT NULL' })
  @Column({ type: 'varchar', length: 20, nullable: true })
  nit?: string;

  @Column({ type: 'varchar', length: 500 })
  address!: string;

  @Column({ type: 'varchar', length: 100 })
  city!: string;

  @Column({ name: 'unit_count', type: 'integer' })
  unitCount!: number;

  @Column({ name: 'is_active', type: 'boolean', default: true })
  isActive!: boolean;

  @OneToMany('Goal', 'condominium')
  goals!: Goal[];
}
```

### Mapeo de Nombres (Documentacion vs Implementacion)

| Documentacion (Espanol) | Implementacion (Ingles) | Columna BD |
|-------------------------|-------------------------|------------|
| nombre | name | name |
| nit | nit | nit |
| direccion | address | address |
| ciudad | city | city |
| cantidadUnidades | unitCount | unit_count |
| isActive | isActive | is_active |

### Relaciones Pendientes

Las siguientes relaciones seran agregadas cuando se creen las entidades correspondientes:

```typescript
// A agregar cuando existan las entidades
@OneToMany(() => Apartment, (apt) => apt.condominium)
apartments: Apartment[];

@OneToMany(() => Tower, (tower) => tower.condominium)
towers: Tower[];

@OneToMany(() => CondominiumAdmin, (admin) => admin.condominium)
administrators: CondominiumAdmin[];
```

## Testing

- [x] Migracion se aplica sin errores
- [x] Se puede crear copropiedad con todos los campos
- [x] NIT es unico cuando se proporciona (unique where not null)
- [ ] Relaciones funcionan correctamente (pendiente otras entidades)

## Notas

- La entidad `Tower` se movio a tarea OB-003-A-004
- Se uso nombrado en ingles segun CLAUDE.md
- El unique constraint de NIT es condicional (where: 'nit IS NOT NULL')
