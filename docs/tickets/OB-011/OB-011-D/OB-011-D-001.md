# OB-011-D-001: Implementar cambio administrativo de visibilidad

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-011 - Visibilidad de Estados de Cuenta |
| Story | OB-011-D - Gestion administrativa de visibilidad |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, admin |
| Depends on | OB-011-B-002 |
| Assigned | unassigned |

## Descripcion

Endpoint para que administradores cambien visibilidad de un residente con justa causa documentada.

## Criterios de Aceptacion

- [ ] POST /api/admin/usuarios/:id/visibilidad implementado
- [ ] Requiere justificacion detallada
- [ ] Requiere causal predefinida
- [ ] Permite adjuntar soporte documental
- [ ] Notifica obligatoriamente al titular

## Notas de Implementacion

Causales validas (segun SUMMARY.md):
- ORDEN_JUDICIAL
- SOLICITUD_TITULAR (via PQR)
- PROTECCION_DERECHOS
- INCUMPLIMIENTO_TERMINOS

Request:
```json
{
  "nuevaVisibilidad": "PRIVADO",
  "causal": "ORDEN_JUDICIAL",
  "justificacion": "Orden del Juzgado 15 Civil Municipal de Bogota, radicado 2025-00123",
  "soporteUrl": "/uploads/soportes/orden-judicial-2025-00123.pdf"
}
```

Response:
```json
{
  "exito": true,
  "cambio": {
    "usuario": "usuario@ejemplo.com",
    "visibilidadAnterior": "PUBLICO",
    "visibilidadNueva": "PRIVADO",
    "causal": "ORDEN_JUDICIAL",
    "realizadoPor": "admin@copropiedad.com",
    "fecha": "2025-01-20T10:00:00Z"
  },
  "notificacion": {
    "enviada": true,
    "metodo": "EMAIL"
  }
}
```

## Testing

- [ ] Solo admin puede usar
- [ ] Sin justificacion falla
- [ ] Causal invalida falla
- [ ] Notificacion se envia
