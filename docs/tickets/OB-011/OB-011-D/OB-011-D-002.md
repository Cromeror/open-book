# OB-011-D-002: Documentar y auditar cambios administrativos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-011 - Visibilidad de Estados de Cuenta |
| Story | OB-011-D - Gestion administrativa de visibilidad |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, auditoria, documentacion |
| Depends on | OB-011-D-001 |
| Assigned | unassigned |

## Descripcion

Asegurar que todos los cambios administrativos de visibilidad queden completamente documentados y auditados.

## Criterios de Aceptacion

- [ ] Registro detallado en ConsentimientoVisibilidad
- [ ] Registro en log de auditoria general
- [ ] Soporte documental almacenado permanentemente
- [ ] Consulta de historial por usuario disponible

## Notas de Implementacion

Al ejecutar cambio administrativo:
1. Crear ConsentimientoVisibilidad con cambiadoPorAdmin=true
2. Registrar en AuditLog general
3. Almacenar soporte documental con referencia
4. Enviar notificacion con copia al archivo

GET /api/admin/usuarios/:id/historial-visibilidad:
```json
{
  "usuario": "usuario@ejemplo.com",
  "historial": [
    {
      "fecha": "2025-01-01",
      "visibilidad": "PUBLICO",
      "tipo": "REGISTRO_INICIAL"
    },
    {
      "fecha": "2025-01-20",
      "visibilidad": "PRIVADO",
      "tipo": "CAMBIO_ADMINISTRATIVO",
      "causal": "ORDEN_JUDICIAL",
      "justificacion": "...",
      "realizadoPor": "admin@copropiedad.com"
    }
  ]
}
```

## Testing

- [ ] Historial es completo
- [ ] Incluye todos los detalles
- [ ] Soportes son accesibles
