# OB-005-B-002: Implementar validaciones especificas por tipo

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-005 - Actividades de Recaudo |
| Story | OB-005-B - Tipos y configuracion de actividades |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, validacion, tipos |
| Depends on | OB-005-B-001 |
| Assigned | unassigned |

## Descripcion

Implementar validaciones especificas para cada tipo de actividad que se aplican al crear compromisos o aportes asociados.

## Contexto Tecnico

### Archivos afectados
- `src/services/actividad.service.ts`
- `src/domain/actividad-validators.ts`

### Enfoque tecnico
Factory de validadores por tipo. Cada tipo tiene reglas especificas para compromisos y aportes.

## Criterios de Aceptacion

- [ ] RIFA: aporte debe ser multiplo del precio de boleta
- [ ] DONACION: aporte puede ser cualquier monto >= minimo
- [ ] CUOTA: aporte debe ser exactamente el monto de la cuota
- [ ] Validadores extensibles para nuevos tipos
- [ ] Mensajes de error claros por tipo

## Notas de Implementacion

```typescript
interface TipoActividadValidator {
  validateAporte(actividad: Actividad, monto: Decimal): void;
  validateCompromiso(actividad: Actividad, monto: Decimal): void;
}

class RifaValidator implements TipoActividadValidator {
  validateAporte(actividad: Actividad, monto: Decimal) {
    const config = actividad.configuracion as RifaConfig;
    const resto = monto.mod(config.precioBoleta);
    if (!resto.isZero()) {
      throw new BusinessError(
        `El monto debe ser multiplo de ${config.precioBoleta} (precio de boleta)`
      );
    }
  }
}

class CuotaValidator implements TipoActividadValidator {
  validateAporte(actividad: Actividad, monto: Decimal) {
    const config = actividad.configuracion as CuotaConfig;
    if (!monto.equals(config.montoCuota)) {
      throw new BusinessError(
        `El monto de la cuota es exactamente ${config.montoCuota}`
      );
    }
  }
}

const VALIDATORS: Record<TipoActividad, TipoActividadValidator> = {
  RIFA: new RifaValidator(),
  DONACION: new DonacionValidator(),
  // ...
};
```

## Testing

- [ ] Rifa rechaza monto no multiplo de boleta
- [ ] Donacion acepta cualquier monto >= minimo
- [ ] Cuota rechaza monto diferente al configurado
- [ ] Validador no encontrado usa default (acepta todo)
