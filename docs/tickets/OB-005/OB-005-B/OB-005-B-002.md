# OB-005-B-002: Implementar validaciones especificas por tipo

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-005 - Actividades de Recaudo |
| Story | OB-005-B - Tipos y configuracion de actividades |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, validacion, tipos |
| Depends on | OB-005-B-001 |
| Assigned | unassigned |

## Descripcion

Implementar validaciones especificas para cada tipo de actividad que se aplican al crear compromisos o aportes asociados.

## Contexto Tecnico

### Archivos afectados
- `src/services/actividad.service.ts`
- `src/domain/actividad-validators.ts`

### Enfoque tecnico
Factory de validadores por tipo. Cada tipo tiene reglas especificas para compromisos y aportes.

## Criterios de Aceptacion

- [ ] RIFA: aporte debe ser multiplo del precio de boleta
- [ ] DONACION: aporte puede ser cualquier monto >= minimo
- [ ] CUOTA: aporte debe ser exactamente el monto de la cuota
- [ ] Validadores extensibles para nuevos tipos
- [ ] Mensajes de error claros por tipo

## Notas de Implementacion

```typescript
// Interfaz para validadores de tipo de actividad
interface ActivityTypeValidator {
  validateContribution(activity: FundraisingActivity, amount: Decimal): void;
  validatePledge(activity: FundraisingActivity, amount: Decimal): void;
}

// Validador para rifas
class RaffleValidator implements ActivityTypeValidator {
  validateContribution(activity: FundraisingActivity, amount: Decimal) {
    const config = activity.configuration as RaffleConfig;
    const remainder = amount.mod(config.ticketPrice);
    if (!remainder.isZero()) {
      throw new BusinessError(
        `El monto debe ser multiplo de ${config.ticketPrice} (precio de boleta)`
      );
    }
  }
}

// Validador para cuotas
class FeeValidator implements ActivityTypeValidator {
  validateContribution(activity: FundraisingActivity, amount: Decimal) {
    const config = activity.configuration as FeeConfig;
    if (!amount.equals(config.feeAmount)) {
      throw new BusinessError(
        `El monto de la cuota es exactamente ${config.feeAmount}`
      );
    }
  }
}

// Registro de validadores por tipo de actividad
const VALIDATORS: Record<ActivityType, ActivityTypeValidator> = {
  RAFFLE: new RaffleValidator(),
  DONATION: new DonationValidator(),
  // ...
};
```

## Testing

- [ ] Rifa rechaza monto no multiplo de boleta
- [ ] Donacion acepta cualquier monto >= minimo
- [ ] Cuota rechaza monto diferente al configurado
- [ ] Validador no encontrado usa default (acepta todo)
