# OB-007-A-002: Implementar endpoint de registro de aporte

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-007 - Aportes Reales |
| Story | OB-007-A - Modelo y registro de aportes |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, registro, aporte |
| Depends on | OB-007-A-001 |
| Assigned | unassigned |

## Descripcion

Implementar el endpoint para registrar nuevos aportes. Este es el punto de entrada principal para el dinero en el sistema y debe capturar toda la informacion necesaria para trazabilidad.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/contributions.routes.ts`
- `src/api/controllers/contributions.controller.ts`
- `src/services/contribution.service.ts`
- `src/api/validators/contribution.validator.ts`

### Enfoque tecnico
Endpoint que captura toda la informacion del aporte incluyendo metadatos de auditoria como IP del registrador.

## Criterios de Aceptacion

- [ ] POST /api/.../activities/:actId/contributions implementado
- [ ] Captura: apartmentId, amount, contributionDate, paymentMethod
- [ ] Captura opcional: notes, receiptNumber
- [ ] Registra IP y usuario que crea
- [ ] Estado inicial PENDIENTE
- [ ] Solo administradores pueden registrar

## Notas de Implementacion

Request:
```
POST /api/condominiums/:condoId/objectives/:objId/activities/:actId/contributions
Authorization: Bearer <token-admin>
Body: {
  "apartmentId": "uuid",
  "amount": 50000,
  "contributionDate": "2025-02-15",
  "paymentMethod": "CASH",
  "notes": "Pago de 5 boletas de rifa",
  "receiptNumber": "REC-001234"
}
```

Response (201):
```json
{
  "id": "uuid",
  "apartment": {
    "number": "101",
    "tower": "Tower A"
  },
  "amount": "50000.00",
  "contributionDate": "2025-02-15T00:00:00Z",
  "paymentMethod": "CASH",
  "status": "PENDING",
  "registeredBy": {
    "name": "Admin Lopez",
    "date": "2025-02-15T10:30:00Z"
  }
}
```

Captura automatica:
- createdBy: ID del admin autenticado
- createdByIp: req.ip o x-forwarded-for
- createdAt: timestamp actual

## Testing

- [ ] Admin puede registrar aporte
- [ ] Residente no puede registrar (403)
- [ ] Validacion de campos funciona
- [ ] IP se captura correctamente
- [ ] Estado es PENDIENTE
