# OB-007-A-002: Implementar endpoint de registro de aporte

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-007 - Aportes Reales |
| Story | OB-007-A - Modelo y registro de aportes |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, registro, aporte |
| Depends on | OB-007-A-001 |
| Assigned | unassigned |

## Descripcion

Implementar el endpoint para registrar nuevos aportes. Este es el punto de entrada principal para el dinero en el sistema y debe capturar toda la informacion necesaria para trazabilidad.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/aportes.routes.ts`
- `src/api/controllers/aportes.controller.ts`
- `src/services/aporte.service.ts`
- `src/api/validators/aporte.validator.ts`

### Enfoque tecnico
Endpoint que captura toda la informacion del aporte incluyendo metadatos de auditoria como IP del registrador.

## Criterios de Aceptacion

- [ ] POST /api/.../actividades/:actId/aportes implementado
- [ ] Captura: apartamentoId, monto, fechaAporte, medioPago
- [ ] Captura opcional: observaciones, numeroComprobante
- [ ] Registra IP y usuario que crea
- [ ] Estado inicial PENDIENTE
- [ ] Solo administradores pueden registrar

## Notas de Implementacion

Request:
```
POST /api/copropiedades/:copId/objetivos/:objId/actividades/:actId/aportes
Authorization: Bearer <token-admin>
Body: {
  "apartamentoId": "uuid",
  "monto": 50000,
  "fechaAporte": "2025-02-15",
  "medioPago": "EFECTIVO",
  "observaciones": "Pago de 5 boletas de rifa",
  "numeroComprobante": "REC-001234"
}
```

Response (201):
```json
{
  "id": "uuid",
  "apartamento": {
    "numero": "101",
    "torre": "Torre A"
  },
  "monto": "50000.00",
  "fechaAporte": "2025-02-15T00:00:00Z",
  "medioPago": "EFECTIVO",
  "estado": "PENDIENTE",
  "registradoPor": {
    "nombre": "Admin Lopez",
    "fecha": "2025-02-15T10:30:00Z"
  }
}
```

Captura automatica:
- createdBy: ID del admin autenticado
- createdByIp: req.ip o x-forwarded-for
- createdAt: timestamp actual

## Testing

- [ ] Admin puede registrar aporte
- [ ] Residente no puede registrar (403)
- [ ] Validacion de campos funciona
- [ ] IP se captura correctamente
- [ ] Estado es PENDIENTE
