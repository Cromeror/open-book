# OB-007-A-003: Validar aporte segun tipo de actividad

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-007 - Aportes Reales |
| Story | OB-007-A - Modelo y registro de aportes |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, validacion, tipos |
| Depends on | OB-007-A-002, OB-005-B-002 |
| Assigned | unassigned |

## Descripcion

Integrar las validaciones de monto segun el tipo de actividad al momento de registrar un aporte. Por ejemplo, en rifas el monto debe ser multiplo del precio de boleta.

## Contexto Tecnico

### Archivos afectados
- `src/services/aporte.service.ts`
- `src/domain/actividad-validators.ts`

### Enfoque tecnico
Reutilizar los validadores por tipo de actividad definidos en OB-005-B-002.

## Criterios de Aceptacion

- [ ] RIFA: monto multiplo de precio de boleta
- [ ] CUOTA: monto igual al monto de cuota
- [ ] DONACION: monto >= monto minimo (si aplica)
- [ ] Validacion solo para actividades activas
- [ ] Mensajes de error claros por tipo

## Notas de Implementacion

```typescript
async function validateAporte(
  actividadId: string,
  monto: Decimal
): Promise<void> {
  const actividad = await typeorm.actividad.findUnique({
    where: { id: actividadId },
    include: { objetivo: true }
  });

  if (!actividad) {
    throw new NotFoundError('Actividad no encontrada');
  }

  if (actividad.estado !== 'ACTIVA') {
    throw new BusinessError(
      'No se pueden registrar aportes en actividades no activas'
    );
  }

  // Validacion especifica por tipo
  const validator = getValidatorForTipo(actividad.tipo);
  validator.validateAporte(actividad, monto);
}
```

Mensajes de error ejemplo:
- RIFA: "El monto ($35,000) debe ser multiplo del precio de boleta ($10,000)"
- CUOTA: "El monto de la cuota es $100,000. Recibido: $80,000"

## Testing

- [ ] Rifa con monto no multiplo es rechazada
- [ ] Cuota con monto diferente es rechazada
- [ ] Actividad no activa rechaza aportes
- [ ] Mensajes de error son claros
