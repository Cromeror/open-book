# OB-002-A-002: Implementar endpoint de registro con NestJS

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-002 - Gestion de Usuarios y Autenticacion |
| Story | OB-002-A - Modelo de usuario y registro |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, registro, endpoint, nestjs |
| Depends on | OB-002-A-001 |
| Assigned | unassigned |

## Descripcion

Implementar el endpoint POST /api/auth/register usando NestJS que permita a nuevos usuarios registrarse en el sistema. El endpoint debe crear el usuario en la base de datos y retornar confirmacion de registro exitoso.

## Contexto Tecnico

### Archivos afectados
- `apps/api/src/modules/auth/auth.controller.ts`
- `apps/api/src/modules/auth/auth.service.ts`
- `apps/api/src/modules/auth/auth.module.ts`
- `apps/api/src/modules/users/users.service.ts`
- `apps/api/src/modules/auth/dto/register.dto.ts`

### Enfoque tecnico
Implementar usando arquitectura modular de NestJS: Controller -> Service -> Repository (TypeORM). Usar decoradores para definir rutas y validacion.

## Criterios de Aceptacion

- [ ] Endpoint POST /api/auth/register creado con @Post decorator
- [ ] Acepta: email, password, firstName, lastName, phone, publicAccountConsent
- [ ] Retorna 201 con datos del usuario (sin passwordHash)
- [ ] Retorna 400 si faltan campos requeridos (ValidationPipe)
- [ ] Retorna 409 si el email ya existe
- [ ] El usuario queda registrado en la base de datos

## Notas de Implementacion

Controller NestJS:
```typescript
@Controller('auth')
export class AuthController {
  constructor(private readonly authService: AuthService) {}

  @Post('register')
  @HttpCode(HttpStatus.CREATED)
  async register(@Body() registerDto: RegisterDto) {
    return this.authService.register(registerDto);
  }
}
```

DTO con class-validator y Zod:
```typescript
import { createZodDto } from 'nestjs-zod';
import { z } from 'zod';

const registerSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
  firstName: z.string().min(1),
  lastName: z.string().min(1),
  phone: z.string().optional(),
  publicAccountConsent: z.boolean(),
});

export class RegisterDto extends createZodDto(registerSchema) {}
```

Request body esperado:
```json
{
  "email": "usuario@ejemplo.com",
  "password": "contrasenaSegura123",
  "firstName": "Juan",
  "lastName": "Perez",
  "phone": "+573001234567",
  "publicAccountConsent": true
}
```

Response exitoso (201):
```json
{
  "id": "uuid",
  "email": "usuario@ejemplo.com",
  "firstName": "Juan",
  "lastName": "Perez",
  "role": "RESIDENT",
  "publicAccountConsent": true,
  "createdAt": "2025-01-01T00:00:00Z"
}
```

## Testing

- [ ] Registro exitoso retorna 201
- [ ] Email duplicado retorna 409
- [ ] Campos faltantes retornan 400
- [ ] El passwordHash no se incluye en la respuesta
