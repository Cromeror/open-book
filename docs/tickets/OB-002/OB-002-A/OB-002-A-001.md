# OB-002-A-001: Crear entidad User con TypeORM

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-002 - Gestion de Usuarios y Autenticacion |
| Story | OB-002-A - Modelo de usuario y registro |
| Status | done |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2026-01-05 |
| Labels | task, entidad, typeorm, usuario |
| Depends on | OB-001-B-002 |
| Assigned | unassigned |

## Descripcion

Crear la entidad User con decoradores TypeORM incluyendo todos los campos necesarios para el sistema, campos de auditoria heredados de BaseEntity, y consentimiento de visibilidad de estados de cuenta.

## Contexto Tecnico

### Archivos afectados
- `apps/api/src/entities/user.entity.ts`
- `apps/api/src/types/user.ts`
- `apps/api/src/modules/users/users.module.ts`

### Enfoque tecnico
Definir la entidad User extendiendo BaseEntity con campos para autenticacion, perfil, rol, y consentimiento. Usar decoradores TypeORM para definir columnas e indices.

## Criterios de Aceptacion

- [x] Entidad User creada con decoradores TypeORM
- [x] Campos de autenticacion: email (unico), passwordHash
- [x] Campos de perfil: firstName, lastName, phone
- [x] Campo rol: role (enum: ADMIN, RESIDENT)
- [x] Campos de consentimiento: publicAccountConsent, consentDate
- [x] Hereda campos de auditoria de BaseEntity
- [x] Indices apropiados (email unico)
- [x] Migracion creada y aplicada

## Notas de Implementacion

Entidad User con TypeORM:
```typescript
import { Entity, Column, Index } from 'typeorm';
import { BaseEntity } from './base.entity';

export enum Role {
  ADMIN = 'ADMIN',
  RESIDENT = 'RESIDENT',
}

@Entity('users')
export class User extends BaseEntity {
  @Column({ unique: true })
  @Index()
  email: string;

  @Column()
  passwordHash: string;

  @Column()
  firstName: string;

  @Column()
  lastName: string;

  @Column({ nullable: true })
  phone: string;

  @Column({
    type: 'enum',
    enum: Role,
    default: Role.RESIDENT,
  })
  role: Role;

  @Column({ default: true })
  isActive: boolean;

  @Column({ default: false })
  publicAccountConsent: boolean;

  @Column({ type: 'timestamp', nullable: true })
  consentDate: Date;

  @Column({ type: 'timestamp', nullable: true })
  lastLoginAt: Date;

  // Relaciones (se agregaran en epicas posteriores)
}
```

## Testing

- [ ] La migracion se aplica sin errores
- [ ] Se puede crear un usuario con todos los campos
- [ ] El email es unico (constraint funciona)
- [ ] Los valores por defecto se aplican correctamente
