# OB-002-D-002: Crear endpoint para editar perfil

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-002 - Gestion de Usuarios y Autenticacion |
| Story | OB-002-D - Gestion de perfil de usuario |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, perfil, edicion |
| Depends on | OB-002-D-001 |
| Assigned | unassigned |

## Descripcion

Crear endpoint que permita a un usuario autenticado editar ciertos campos de su perfil. No todos los campos son editables (email y rol no pueden cambiarse por el usuario).

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/users.routes.ts`
- `src/api/controllers/users.controller.ts`
- `src/services/user.service.ts`
- `src/api/validators/user.validator.ts`

### Enfoque tecnico
Endpoint PATCH que acepta campos editables y actualiza solo esos campos. Registrar cambios en auditoria.

## Criterios de Aceptacion

- [ ] Endpoint PATCH /api/users/me creado
- [ ] Permite editar: firstName, lastName, phone
- [ ] NO permite editar: email, role, publicAccountConsent
- [ ] Valida datos de entrada
- [ ] Registra cambio en auditoria con campos modificados
- [ ] Retorna perfil actualizado

## Notas de Implementacion

Request:
```
PATCH /api/users/me
Authorization: Bearer <token>
Body: {
  "firstName": "Juan Carlos",
  "phone": "+573009999999"
}
```

Response (200):
```json
{
  "id": "uuid",
  "email": "usuario@ejemplo.com",
  "firstName": "Juan Carlos",
  "lastName": "Perez",
  "phone": "+573009999999",
  // ... resto del perfil
}
```

Nota: El cambio de publicAccountConsent requiere PQR (ver OB-011)

## Testing

- [ ] Campos permitidos se actualizan correctamente
- [ ] Intento de cambiar email es ignorado o retorna error
- [ ] Intento de cambiar role es ignorado o retorna error
- [ ] Cambio queda registrado en auditoria
