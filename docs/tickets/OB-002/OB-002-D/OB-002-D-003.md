# OB-002-D-003: Implementar cambio de contrasena

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-002 - Gestion de Usuarios y Autenticacion |
| Story | OB-002-D - Gestion de perfil de usuario |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, seguridad, contrasena |
| Depends on | OB-002-A-004 |
| Assigned | unassigned |

## Descripcion

Implementar endpoint que permita a un usuario cambiar su contrasena. Por seguridad, debe requerir la contrasena actual antes de aceptar la nueva.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/auth.routes.ts`
- `src/api/controllers/auth.controller.ts`
- `src/services/auth.service.ts`

### Enfoque tecnico
Verificar contrasena actual, validar nueva contrasena, hashear y actualizar. Invalidar sesiones existentes opcionalmente.

## Criterios de Aceptacion

- [ ] Endpoint POST /api/auth/change-password creado
- [ ] Requiere autenticacion
- [ ] Requiere contrasena actual correcta
- [ ] Nueva contrasena cumple requisitos de fortaleza
- [ ] Nueva contrasena no puede ser igual a la actual
- [ ] Registra evento en auditoria (sin guardar contrasenas)

## Notas de Implementacion

Request:
```
POST /api/auth/change-password
Authorization: Bearer <token>
Body: {
  "currentPassword": "contrasenaActual123",
  "newPassword": "nuevaContrasena456"
}
```

Response exitoso (200):
```json
{
  "message": "Contrasena actualizada exitosamente"
}
```

Response error (400):
```json
{
  "error": "Contrasena actual incorrecta"
}
```

Consideraciones:
- Invalidar todos los refresh tokens del usuario
- Opcionalmente forzar re-login despues del cambio

## Testing

- [ ] Cambio exitoso con contrasena actual correcta
- [ ] Falla con contrasena actual incorrecta
- [ ] Falla si nueva contrasena es debil
- [ ] Falla si nueva = actual
- [ ] Evento queda en auditoria
