# OB-002-B-001: Implementar endpoint de login

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-002 - Gestion de Usuarios y Autenticacion |
| Story | OB-002-B - Autenticacion con JWT |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, login, autenticacion |
| Depends on | OB-002-A-004 |
| Assigned | unassigned |

## Descripcion

Implementar el endpoint POST /api/auth/login que permita a usuarios registrados autenticarse con email y contrasena. El endpoint debe verificar credenciales y retornar tokens de acceso.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/auth.routes.ts`
- `src/api/controllers/auth.controller.ts`
- `src/services/auth.service.ts`

### Enfoque tecnico
Verificar email existe, comparar contrasena con bcrypt, generar tokens si es exitoso, retornar error generico si falla (no revelar si email existe).

## Criterios de Aceptacion

- [ ] Endpoint POST /api/auth/login creado
- [ ] Acepta email y password en el body
- [ ] Retorna 200 con accessToken y refreshToken si es exitoso
- [ ] Retorna 401 con mensaje generico si falla
- [ ] Actualiza lastLoginAt del usuario
- [ ] No revela si el email existe o no

## Notas de Implementacion

Request:
```json
{
  "email": "usuario@ejemplo.com",
  "password": "contrasena123"
}
```

Response exitoso (200):
```json
{
  "accessToken": "eyJhbG...",
  "refreshToken": "eyJhbG...",
  "user": {
    "id": "uuid",
    "email": "usuario@ejemplo.com",
    "firstName": "Juan",
    "role": "RESIDENT"
  }
}
```

Response error (401):
```json
{
  "error": "Credenciales invalidas"
}
```

## Testing

- [ ] Login exitoso retorna tokens
- [ ] Email incorrecto retorna 401
- [ ] Password incorrecto retorna 401
- [ ] Usuario inactivo no puede hacer login
- [ ] lastLoginAt se actualiza
