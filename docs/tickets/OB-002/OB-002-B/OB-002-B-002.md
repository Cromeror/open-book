# OB-002-B-002: Generar y firmar JWT

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-002 - Gestion de Usuarios y Autenticacion |
| Story | OB-002-B - Autenticacion con JWT |
| Status | done |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, jwt, seguridad, tokens |
| Depends on | OB-002-B-001 |
| Assigned | unassigned |

## Descripcion

Implementar la generacion y firma de JSON Web Tokens (JWT) para autenticacion. Crear funciones para generar access tokens y refresh tokens con diferentes tiempos de expiracion.

## Contexto Tecnico

### Archivos afectados
- `src/utils/jwt.ts`
- `src/config/env.ts` (variables JWT)
- `src/types/jwt.ts`

### Enfoque tecnico
Usar la libreria jsonwebtoken para generar y verificar tokens. Configurar secretos y expiraciones via variables de entorno.

## Criterios de Aceptacion

- [x] Funcion generateAccessToken(user) implementada
- [x] Funcion generateRefreshToken(user) implementada
- [x] Funcion verifyAccessToken(token) implementada
- [x] Access token expira en 15 minutos (configurable)
- [x] Refresh token expira en 7 dias (configurable)
- [x] Secretos configurados via variables de entorno

## Notas de Implementacion

```typescript
interface JwtPayload {
  sub: string;      // user id
  email: string;
  role: Role;
  type: 'access' | 'refresh';
}

// Variables de entorno necesarias:
// JWT_SECRET
// JWT_ACCESS_EXPIRES_IN (ej: '15m')
// JWT_REFRESH_EXPIRES_IN (ej: '7d')
```

Considerar:
- Usar algoritmo RS256 para produccion (con par de llaves)
- HS256 es aceptable para desarrollo
- Incluir jti (JWT ID) para invalidacion individual

## Testing

- [ ] generateAccessToken genera token valido
- [ ] generateRefreshToken genera token valido
- [ ] verifyToken valida tokens correctos
- [ ] verifyToken rechaza tokens expirados
- [ ] verifyToken rechaza tokens con firma invalida
