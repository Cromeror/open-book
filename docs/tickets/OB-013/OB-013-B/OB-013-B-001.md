# OB-013-B-001: Configurar servicio de email

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-013 - Notificaciones |
| Story | OB-013-B - Notificaciones por email |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, email, configuracion |
| Depends on | OB-001-A-003 |
| Assigned | unassigned |

## Descripcion

Configurar el servicio de envío de emails utilizando un proveedor externo (SendGrid, AWS SES, etc.).

## Criterios de Aceptacion

- [ ] Servicio de email configurado
- [ ] Variables de entorno documentadas
- [ ] Método de envío implementado
- [ ] Manejo de errores robusto

## Notas de Implementacion

Variables de entorno:
```env
# .env
EMAIL_PROVIDER=sendgrid  # sendgrid | ses | smtp
SENDGRID_API_KEY=SG.xxxxx
EMAIL_FROM=noreply@openbook.com
EMAIL_FROM_NAME=OpenBook
```

```typescript
// src/services/email.service.ts

import sgMail from '@sendgrid/mail';

interface EmailOptions {
  to: string;
  subject: string;
  html: string;
  text?: string;
}

class EmailService {
  constructor() {
    if (process.env.EMAIL_PROVIDER === 'sendgrid') {
      sgMail.setApiKey(process.env.SENDGRID_API_KEY!);
    }
  }

  async enviar(options: EmailOptions): Promise<boolean> {
    try {
      if (process.env.EMAIL_PROVIDER === 'sendgrid') {
        await sgMail.send({
          to: options.to,
          from: {
            email: process.env.EMAIL_FROM!,
            name: process.env.EMAIL_FROM_NAME!,
          },
          subject: options.subject,
          html: options.html,
          text: options.text || this.stripHtml(options.html),
        });
      }

      return true;
    } catch (error) {
      console.error('Error enviando email:', error);
      return false;
    }
  }

  private stripHtml(html: string): string {
    return html.replace(/<[^>]*>/g, '');
  }
}

export const emailService = new EmailService();
```

Para desarrollo local:
```typescript
// Usar Ethereal o MailHog para pruebas
if (process.env.NODE_ENV === 'development') {
  // Log email en consola en lugar de enviar
  console.log('Email simulado:', options);
}
```

## Testing

- [ ] Configuración correcta de SendGrid
- [ ] Email se envía exitosamente
- [ ] Errores manejados sin crash
- [ ] Modo desarrollo funciona
