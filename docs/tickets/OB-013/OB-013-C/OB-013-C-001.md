# OB-013-C-001: Implementar endpoint de notificaciones

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-013 - Notificaciones |
| Story | OB-013-C - Notificaciones in-app |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, consulta |
| Depends on | OB-013-A-001 |
| Assigned | unassigned |

## Descripcion

Crear endpoint para que los usuarios consulten sus notificaciones in-app.

## Criterios de Aceptacion

- [ ] GET /api/notificaciones implementado
- [ ] Paginación funcional
- [ ] Filtro por estado (leídas/no leídas)
- [ ] Contador de no leídas

## Notas de Implementacion

Request:
```
GET /api/notificaciones?page=1&limit=20&leidas=false
Authorization: Bearer <token>
```

Response:
```json
{
  "data": [
    {
      "id": "uuid",
      "tipo": "APORTE_CONFIRMADO",
      "titulo": "Aporte confirmado",
      "mensaje": "Su aporte de $50,000 ha sido confirmado",
      "leida": false,
      "obligatoria": false,
      "entidadTipo": "APORTE",
      "entidadId": "uuid-del-aporte",
      "createdAt": "2025-01-15T10:30:00Z"
    }
  ],
  "meta": {
    "total": 45,
    "noLeidas": 12,
    "page": 1,
    "limit": 20,
    "totalPages": 3
  }
}
```

Implementación:
```typescript
// GET /api/notificaciones
async getNotificaciones(req: Request, res: Response) {
  const { page = 1, limit = 20, leidas } = req.query;
  const usuarioId = req.user.id;

  const where: typeorm.NotificacionWhereInput = {
    usuarioId,
    canal: { in: ['IN_APP', 'AMBOS'] },
  };

  if (leidas !== undefined) {
    where.leida = leidas === 'true';
  }

  const [data, total, noLeidas] = await Promise.all([
    typeorm.notificacion.findMany({
      where,
      skip: (Number(page) - 1) * Number(limit),
      take: Number(limit),
      orderBy: { createdAt: 'desc' },
    }),
    typeorm.notificacion.count({ where }),
    typeorm.notificacion.count({
      where: { usuarioId, leida: false, canal: { in: ['IN_APP', 'AMBOS'] } }
    }),
  ]);

  res.json({
    data,
    meta: {
      total,
      noLeidas,
      page: Number(page),
      limit: Number(limit),
      totalPages: Math.ceil(total / Number(limit)),
    },
  });
}
```

Endpoint de contador rápido:
```
GET /api/notificaciones/contador
Response: { "noLeidas": 12 }
```

## Testing

- [ ] Lista notificaciones del usuario actual
- [ ] Paginación funciona
- [ ] Filtro por leídas funciona
- [ ] Contador es correcto
