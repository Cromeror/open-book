# OB-001-B-004: Configurar sistema de migraciones

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-001 - Configuracion e Infraestructura del Proyecto |
| Story | OB-001-B - Configuracion de base de datos y ORM |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, migraciones, database |
| Depends on | OB-001-B-003 |
| Assigned | unassigned |

## Descripcion

Configurar el sistema de migraciones de TypeORM para manejar cambios en el esquema de base de datos de forma controlada y versionada. Las migraciones son criticas para mantener consistencia entre entornos.

## Contexto Tecnico

### Archivos afectados
- `apps/api/src/migrations/` (directorio de migraciones)
- `apps/api/src/config/typeorm.config.ts` (configuracion CLI)
- `package.json` (scripts de migracion)

### Enfoque tecnico
Usar TypeORM CLI para generar y ejecutar migraciones. Configurar scripts para crear, aplicar y revertir migraciones en el monorepo Nx.

## Criterios de Aceptacion

- [ ] Directorio apps/api/src/migrations/ creado y versionado
- [ ] Scripts pnpm: migration:generate, migration:run, migration:revert
- [ ] Archivo typeorm.config.ts para CLI configurado
- [ ] Primera migracion inicial creada
- [ ] Proceso documentado para crear nuevas migraciones
- [ ] Las migraciones se ejecutan en CI/CD

## Notas de Implementacion

Ejemplo de configuracion TypeORM CLI:

```typescript
// apps/api/src/config/typeorm.config.ts
import { DataSource } from 'typeorm';
import { config } from 'dotenv';

config();

export default new DataSource({
  type: 'postgres',
  host: process.env.DB_HOST,
  port: parseInt(process.env.DB_PORT, 10),
  username: process.env.DB_USERNAME,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_DATABASE,
  entities: ['src/entities/**/*.entity.ts'],
  migrations: ['src/migrations/**/*.ts'],
});
```

Scripts en package.json:
- `pnpm migration:generate` - Genera migracion basada en cambios
- `pnpm migration:run` - Ejecuta migraciones pendientes
- `pnpm migration:revert` - Revierte ultima migracion

## Testing

- [ ] pnpm migration:generate crea migracion correctamente
- [ ] pnpm migration:run aplica migraciones
- [ ] pnpm migration:revert revierte correctamente
- [ ] Las migraciones son idempotentes
