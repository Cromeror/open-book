# OB-006-A-002: Implementar CRUD de compromisos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-006 - Compromisos de Aporte |
| Story | OB-006-A - Modelo y CRUD de compromisos |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, crud, compromiso |
| Depends on | OB-006-A-001 |
| Assigned | unassigned |

## Descripcion

Implementar endpoints REST para el CRUD de compromisos de aporte. Los compromisos se gestionan bajo la actividad a la que pertenecen.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/compromisos.routes.ts`
- `src/api/controllers/compromisos.controller.ts`
- `src/services/compromiso.service.ts`
- `src/api/validators/compromiso.validator.ts`

### Enfoque tecnico
Endpoints anidados bajo actividad. Solo admins pueden crear/editar.

## Criterios de Aceptacion

- [ ] POST /api/.../actividades/:actId/compromisos - Crear
- [ ] GET /api/.../actividades/:actId/compromisos - Listar
- [ ] GET /api/.../actividades/:actId/compromisos/:id - Obtener
- [ ] PATCH /api/.../actividades/:actId/compromisos/:id - Actualizar
- [ ] DELETE /api/.../actividades/:actId/compromisos/:id - Soft delete
- [ ] Solo admins pueden gestionar
- [ ] Response incluye estado calculado

## Notas de Implementacion

Crear compromiso:
```
POST /api/copropiedades/:copId/objetivos/:objId/actividades/:actId/compromisos
Body: {
  "apartamentoId": "uuid",
  "montoComprometido": 50000,
  "observaciones": "Compromiso de 5 boletas de rifa"
}
```

Response (201):
```json
{
  "id": "uuid",
  "apartamento": {
    "id": "uuid",
    "numero": "101",
    "torre": "Torre A"
  },
  "actividad": {
    "id": "uuid",
    "nombre": "Rifa electrodomesticos"
  },
  "montoComprometido": "50000.00",
  "estado": "PENDIENTE",
  "montoAportado": "0.00",
  "createdAt": "2025-01-15T00:00:00Z"
}
```

Listar con filtros:
```
GET /api/.../actividades/:actId/compromisos?estado=PENDIENTE&torre=uuid
```

## Testing

- [ ] Admin puede crear compromiso
- [ ] Residente no puede crear (403)
- [ ] Response incluye estado calculado
- [ ] Validacion de datos funciona
