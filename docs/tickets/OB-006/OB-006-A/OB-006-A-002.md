# OB-006-A-002: Implementar CRUD de compromisos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-006 - Compromisos de Aporte |
| Story | OB-006-A - Modelo y CRUD de compromisos |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, crud, compromiso |
| Depends on | OB-006-A-001 |
| Assigned | unassigned |

## Descripcion

Implementar endpoints REST para el CRUD de compromisos de aporte. Los compromisos se gestionan bajo la actividad a la que pertenecen.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/pledges.routes.ts`
- `src/api/controllers/pledges.controller.ts`
- `src/services/pledge.service.ts`
- `src/api/validators/pledge.validator.ts`

### Enfoque tecnico
Endpoints anidados bajo actividad. Solo admins pueden crear/editar.

## Criterios de Aceptacion

- [ ] POST /api/.../activities/:actId/pledges - Crear
- [ ] GET /api/.../activities/:actId/pledges - Listar
- [ ] GET /api/.../activities/:actId/pledges/:id - Obtener
- [ ] PATCH /api/.../activities/:actId/pledges/:id - Actualizar
- [ ] DELETE /api/.../activities/:actId/pledges/:id - Soft delete
- [ ] Solo admins pueden gestionar
- [ ] Response incluye estado calculado

## Notas de Implementacion

Crear compromiso:
```
POST /api/condominiums/:condoId/objectives/:objId/activities/:actId/pledges
Body: {
  "apartmentId": "uuid",
  "pledgedAmount": 50000,
  "notes": "Compromiso de 5 boletas de rifa"
}
```

Response (201):
```json
{
  "id": "uuid",
  "apartment": {
    "id": "uuid",
    "number": "101",
    "tower": "Tower A"
  },
  "activity": {
    "id": "uuid",
    "name": "Rifa electrodomesticos"
  },
  "pledgedAmount": "50000.00",
  "status": "PENDING",
  "contributedAmount": "0.00",
  "createdAt": "2025-01-15T00:00:00Z"
}
```

Listar con filtros:
```
GET /api/.../activities/:actId/pledges?status=PENDING&tower=uuid
```

## Testing

- [ ] Admin puede crear compromiso
- [ ] Residente no puede crear (403)
- [ ] Response incluye estado calculado
- [ ] Validacion de datos funciona
