# OB-006-A-004: Implementar registro masivo de compromisos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-006 - Compromisos de Aporte |
| Story | OB-006-A - Modelo y CRUD de compromisos |
| Status | pending |
| Priority | medium |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, api, bulk, importacion |
| Depends on | OB-006-A-003 |
| Assigned | unassigned |

## Descripcion

Implementar funcionalidad para crear compromisos para multiples apartamentos en una sola operacion. Util para cuotas donde todos los apartamentos se comprometen al mismo monto.

## Contexto Tecnico

### Archivos afectados
- `src/api/routes/pledges.routes.ts`
- `src/api/controllers/pledges.controller.ts`
- `src/services/pledge.service.ts`

### Enfoque tecnico
Endpoint bulk que acepta lista de apartamentos o filtros, y crea compromisos para todos en transaccion.

## Criterios de Aceptacion

- [ ] POST /api/.../activities/:id/pledges/bulk implementado
- [ ] Acepta lista de apartamentos o "todos"
- [ ] Mismo monto para todos o montos individuales
- [ ] Transaccion: todo o nada
- [ ] Resumen de creados/omitidos/errores

## Notas de Implementacion

Request - todos con mismo monto:
```
POST /api/.../activities/:actId/pledges/bulk
Body: {
  "apartments": "ALL",  // o "TOWER_A" o lista de IDs
  "pledgedAmount": 100000,
  "notes": "Cuota extraordinaria marzo"
}
```

Request - montos individuales:
```
POST /api/.../activities/:actId/pledges/bulk
Body: {
  "pledges": [
    { "apartmentId": "uuid1", "pledgedAmount": 100000 },
    { "apartmentId": "uuid2", "pledgedAmount": 150000 }
  ]
}
```

Response:
```json
{
  "summary": {
    "total": 120,
    "created": 115,
    "skipped": 5,
    "errors": 0
  },
  "skipped": [
    { "apartmentId": "uuid", "number": "101", "reason": "Ya existe compromiso" }
  ],
  "errors": []
}
```

La operacion omite (no falla) apartamentos con compromiso existente.

## Testing

- [ ] Bulk crea compromisos para todos los apartamentos
- [ ] Apartamentos con compromiso existente se omiten
- [ ] Transaccion funciona (rollback en error critico)
- [ ] Resumen es preciso
