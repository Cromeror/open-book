# OB-006-A-001: Crear entidad Compromiso con TypeORM

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-006 - Compromisos de Aporte |
| Story | OB-006-A - Modelo y CRUD de compromisos |
| Status | pending |
| Priority | critical |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, entidad, typeorm, compromiso |
| Depends on | OB-003-B-001, OB-005-A-001 |
| Assigned | unassigned |

## Descripcion

Crear la entidad Compromiso con decoradores TypeORM segun SUMMARY.md seccion 4.4: monto comprometido, actividad asociada, estado del compromiso.

## Contexto Tecnico

### Archivos afectados
- `apps/api/src/entities/compromiso.entity.ts`
- `apps/api/src/types/compromiso.ts`

### Enfoque tecnico
Entidad con relaciones a Apartamento y Actividad usando TypeORM. Estado para seguimiento. Unicidad por par apartamento-actividad.

## Criterios de Aceptacion

- [ ] Entidad Compromiso creada con decoradores TypeORM
- [ ] Campos: montoComprometido, estado, observaciones
- [ ] Relacion con Apartamento (obligatoria)
- [ ] Relacion con Actividad (obligatoria)
- [ ] Indice unico (apartamentoId, actividadId)
- [ ] Hereda campos de auditoria de BaseEntity
- [ ] Relacion con Aportes (para calcular cumplimiento)

## Notas de Implementacion

Entidad Compromiso con TypeORM:
```typescript
import { Entity, Column, ManyToOne, OneToMany, JoinColumn, Unique, Index } from 'typeorm';
import { BaseEntity } from './base.entity';
import { Apartamento } from './apartamento.entity';
import { Actividad } from './actividad.entity';
import { Aporte } from './aporte.entity';

export enum EstadoCompromiso {
  PENDIENTE = 'PENDIENTE',   // Sin aportes o aportes < monto
  PARCIAL = 'PARCIAL',       // Aportes > 0 pero < monto
  CUMPLIDO = 'CUMPLIDO',     // Aportes >= monto
}

@Entity('compromisos')
@Unique(['apartamentoId', 'actividadId'])
export class Compromiso extends BaseEntity {
  @Column()
  @Index()
  apartamentoId: string;

  @ManyToOne(() => Apartamento, (apt) => apt.compromisos)
  @JoinColumn({ name: 'apartamentoId' })
  apartamento: Apartamento;

  @Column()
  @Index()
  actividadId: string;

  @ManyToOne(() => Actividad, (act) => act.compromisos)
  @JoinColumn({ name: 'actividadId' })
  actividad: Actividad;

  @Column({ type: 'decimal', precision: 15, scale: 2 })
  montoComprometido: number;

  @Column({
    type: 'enum',
    enum: EstadoCompromiso,
    default: EstadoCompromiso.PENDIENTE,
  })
  estado: EstadoCompromiso;

  @Column({ type: 'text', nullable: true })
  observaciones: string;

  // Relaciones
  @OneToMany(() => Aporte, (a) => a.compromiso)
  aportes: Aporte[];
}
```

Nota: El estado se calcula automaticamente basado en los aportes asociados (ver OB-006-B)

## Testing

- [ ] Migracion se aplica sin errores
- [ ] Constraint de unicidad funciona
- [ ] Relaciones funcionan correctamente
- [ ] Estado inicial es PENDIENTE
