# OB-014-C-001: Crear DynamicNav basado en modulos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-014 - Configuracion de Vistas por Permisos y Modulos |
| Story | OB-014-C - Navegacion adaptativa por modulos |
| Status | done |
| Priority | high |
| Created | 2026-01-05 |
| Updated | 2026-01-06 |
| Labels | task, frontend, navigation, modulos |
| Depends on | OB-014-A-001 |
| Assigned | unassigned |

## Descripcion

Crear el sistema de navegacion dinamica que filtra items del menu basado en los modulos asignados al usuario.

## Contexto Tecnico

### Archivos creados/modificados
- `apps/web/src/lib/nav-config.ts` - Configuracion central de navegacion
- `apps/web/src/lib/nav-filter.server.ts` - Filtrado server-side por permisos
- `apps/web/src/components/layout/Sidebar.tsx` - Renderizado de navegacion

### Enfoque tecnico
- **Server-First**: La navegacion se filtra en el servidor usando `filterNavItems()`
- **Sin roles predefinidos**: SuperAdmin ve todo, usuarios ven solo modulos asignados
- **Configuracion centralizada**: `NAV_CONFIG` define todos los items con sus requisitos

## Criterios de Aceptacion

- [x] Navegacion filtra items segun modulos accesibles
- [x] SuperAdmin ve todas las opciones
- [x] Usuarios ven solo modulos asignados
- [x] Items con `module: null` siempre visibles (Dashboard)
- [x] Items con `superAdminOnly: true` solo para SuperAdmin

## Implementacion Final

```typescript
// apps/web/src/lib/nav-config.ts
export const NAV_CONFIG: NavItem[] = [
  { path: '/dashboard', label: 'Inicio', icon: 'Home', module: null },
  { path: '/objetivos', label: 'Objetivos', icon: 'Target', module: 'objetivos', children: [...] },
  { path: '/admin', label: 'Administracion', icon: 'Shield', superAdminOnly: true, children: [...] },
  // ...
];

// apps/web/src/lib/nav-filter.server.ts
export function filterNavItems(permissions: ServerPermissions): NavItem[] {
  const filterItems = (items: NavItem[]): NavItem[] => {
    return items
      .filter((item) => {
        if (permissions.isSuperAdmin) return true;
        if (item.superAdminOnly) return false;
        if (item.module && !permissions.hasModule(item.module)) return false;
        if (item.permission && !permissions.can(item.permission)) return false;
        return true;
      })
      .map((item) => ({
        ...item,
        children: item.children ? filterItems(item.children) : undefined,
      }))
      .filter((item) => !item.children || item.children.length > 0);
  };
  return filterItems(NAV_CONFIG);
}
```

## Testing

- [x] Navegacion filtra correctamente por modulos
- [x] SuperAdmin ve todos los items
- [x] Build pasa sin errores
