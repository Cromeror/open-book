# OB-014-D-012: Crear componentes compartidos de permisos

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-014 - Configuracion de Vistas por Permisos y Modulos |
| Story | OB-014-D - Scaffolding de modulos con permisos |
| Status | done |
| Priority | high |
| Created | 2026-01-06 |
| Updated | 2026-01-06 |
| Labels | task, frontend, components, permisos |
| Depends on | OB-014-A |

## Descripcion

Crear componentes reutilizables para renderizado condicional basado en permisos. Estos componentes seran usados en todos los modulos para mostrar/ocultar elementos segun los permisos del usuario.

## Estructura de Archivos

```
apps/web/src/components/permissions/
├── ShowForModule.tsx           # Muestra contenido si tiene acceso al modulo
├── ShowForPermission.tsx       # Muestra contenido si tiene permiso granular
├── ShowForSuperAdmin.tsx       # Muestra contenido solo para SuperAdmin
├── ShowForAnyModule.tsx        # Muestra si tiene acceso a cualquiera de los modulos
├── PermissionGate.tsx          # Gate generico con fallback
├── AccessDenied.tsx            # Pagina de acceso denegado reutilizable
├── ModulePlaceholder.tsx       # Placeholder para modulos no implementados
└── index.ts                    # Exports
```

## Componentes a Crear

### ShowForModule
```typescript
interface ShowForModuleProps {
  module: string;
  children: ReactNode;
  fallback?: ReactNode;
}
```
Muestra `children` solo si el usuario tiene acceso al modulo especificado.

### ShowForPermission
```typescript
interface ShowForPermissionProps {
  permission: string;           // Formato: "modulo:accion"
  context?: PermissionContext;  // Para permisos con scope
  children: ReactNode;
  fallback?: ReactNode;
}
```
Muestra `children` solo si el usuario tiene el permiso granular.

### ShowForSuperAdmin
```typescript
interface ShowForSuperAdminProps {
  children: ReactNode;
  fallback?: ReactNode;
}
```
Muestra `children` solo para SuperAdmin.

### ModulePlaceholder
```typescript
interface ModulePlaceholderProps {
  moduleName: string;
  permission?: string;
  epic: string;
  description?: string;
}
```
Placeholder estandarizado para modulos pendientes de implementacion.

## Criterios de Aceptacion

- [ ] Todos los componentes creados y exportados
- [ ] Componentes usan ServerPermissions (no hooks client-side)
- [ ] ModulePlaceholder muestra info de implementacion
- [ ] AccessDenied reutilizable en todas las paginas
- [ ] Types exportados correctamente
- [ ] Build pasa sin errores

## Uso Esperado

```tsx
// En Server Component
import { ShowForPermission, ModulePlaceholder } from '@/components/permissions';

export default async function ObjetivosPage() {
  return (
    <div>
      <h1>Objetivos</h1>

      <ShowForPermission permission="objetivos:create">
        <Button>Crear Objetivo</Button>
      </ShowForPermission>

      {/* Mientras no este implementado */}
      <ModulePlaceholder
        moduleName="Objetivos de Recaudo"
        permission="objetivos:read"
        epic="OB-004"
        description="Lista y gestion de objetivos de recaudo"
      />
    </div>
  );
}
```

## Notas Tecnicas

- Estos componentes funcionan en Server Components
- Reciben permisos como props (pre-calculados desde getServerPermissions)
- No usan hooks de cliente (usePermissions es para client components)
- SuperAdmin siempre bypasea verificaciones
