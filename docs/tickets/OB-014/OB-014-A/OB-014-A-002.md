# OB-014-A-002: Implementar hook useAuth

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-014 - Configuracion de Vistas por Rol de Usuario |
| Story | OB-014-A - Contexto de autenticacion y proteccion de rutas |
| Status | pending |
| Priority | high |
| Created | 2026-01-05 |
| Updated | 2026-01-05 |
| Labels | task, frontend, hooks, auth |
| Depends on | OB-014-A-001 |
| Assigned | unassigned |

## Descripcion

Crear hook personalizado useAuth que exponga funcionalidades de autenticacion y utilidades adicionales como verificacion de permisos.

## Contexto Tecnico

### Archivos afectados
- `apps/web/src/hooks/useAuth.ts`
- `apps/web/src/hooks/usePermissions.ts`

### Enfoque tecnico
Hooks que encapsulan la logica de autenticacion y permisos, facilitando su uso en componentes.

## Criterios de Aceptacion

- [ ] useAuth retorna estado y funciones de auth
- [ ] usePermissions verifica permisos por rol
- [ ] Funciones helper: isAdmin, isResident
- [ ] Hook de redireccion segun estado de auth

## Notas de Implementacion

```typescript
// hooks/useAuth.ts
import { useAuthContext } from '@/contexts/AuthContext';
import { Role } from '@/types/auth';

export function useAuth() {
  const context = useAuthContext();

  return {
    ...context,
    isAdmin: context.user?.role === Role.ADMIN,
    isResident: context.user?.role === Role.RESIDENT,
  };
}

// hooks/usePermissions.ts
import { useAuth } from './useAuth';
import { Role } from '@/types/auth';

const PERMISSIONS = {
  // Administrador
  'users:read': [Role.ADMIN],
  'users:write': [Role.ADMIN],
  'copropiedades:write': [Role.ADMIN],
  'reportes:generate': [Role.ADMIN],
  'objetivos:write': [Role.ADMIN],

  // Ambos roles
  'copropiedades:read': [Role.ADMIN, Role.RESIDENT],
  'objetivos:read': [Role.ADMIN, Role.RESIDENT],
  'aportes:read': [Role.ADMIN, Role.RESIDENT],
  'pqr:create': [Role.ADMIN, Role.RESIDENT],

  // Solo residente
  'mis-aportes:read': [Role.RESIDENT, Role.ADMIN],
} as const;

type Permission = keyof typeof PERMISSIONS;

export function usePermissions() {
  const { user } = useAuth();

  const hasPermission = (permission: Permission): boolean => {
    if (!user) return false;
    return PERMISSIONS[permission]?.includes(user.role) ?? false;
  };

  const hasAnyPermission = (permissions: Permission[]): boolean => {
    return permissions.some(hasPermission);
  };

  const hasAllPermissions = (permissions: Permission[]): boolean => {
    return permissions.every(hasPermission);
  };

  return { hasPermission, hasAnyPermission, hasAllPermissions };
}
```

## Testing

- [ ] useAuth retorna valores correctos
- [ ] isAdmin/isResident funcionan segun rol
- [ ] hasPermission verifica correctamente
