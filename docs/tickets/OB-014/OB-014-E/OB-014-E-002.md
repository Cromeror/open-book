# OB-014-E-002: Implementar hook usePermissions

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-014 - Configuracion de Vistas por Rol y Sistema de Permisos Granulares |
| Story | OB-014-E - Sistema de permisos granulares |
| Status | pending |
| Priority | high |
| Created | 2026-01-05 |
| Updated | 2026-01-05 |
| Labels | task, frontend, permissions, hooks |
| Depends on | OB-014-E-001 |
| Assigned | unassigned |

## Descripcion

Crear el hook `usePermissions` que proporciona funciones para verificar permisos del usuario autenticado. Este hook sera la interfaz principal para consultar permisos en componentes React.

## Contexto Tecnico

### Archivos afectados
- `apps/web/src/hooks/usePermissions.ts`
- `apps/web/src/hooks/index.ts`

### Enfoque tecnico
El hook debe obtener el rol del usuario del contexto de autenticacion y exponer funciones para verificar permisos individuales o multiples. Debe manejar wildcards y ser eficiente en re-renders.

## Criterios de Aceptacion

- [ ] Hook usePermissions creado y exportado
- [ ] Funcion `can(permission)` para verificar un permiso
- [ ] Funcion `canAny(permissions)` para verificar al menos uno
- [ ] Funcion `canAll(permissions)` para verificar todos
- [ ] Obtiene rol del usuario desde AuthContext
- [ ] Maneja wildcards correctamente (resource:*)
- [ ] Memoizado para evitar re-renders innecesarios
- [ ] Tests unitarios

## Notas de Implementacion

```typescript
// hooks/usePermissions.ts
import { useMemo, useCallback } from 'react';
import { useAuth } from './useAuth';
import { Permission, getPermissionsForRole, permissionMatches } from '@/lib/permissions';

export interface UsePermissionsReturn {
  /** Check if user has a specific permission */
  can: (permission: Permission) => boolean;
  /** Check if user has at least one of the permissions */
  canAny: (permissions: Permission[]) => boolean;
  /** Check if user has all of the permissions */
  canAll: (permissions: Permission[]) => boolean;
  /** All permissions for the current user */
  permissions: Permission[];
  /** Whether the user is authenticated */
  isAuthenticated: boolean;
}

export function usePermissions(): UsePermissionsReturn {
  const { user, isAuthenticated } = useAuth();

  const permissions = useMemo(() => {
    if (!user?.role) return [];
    return getPermissionsForRole(user.role);
  }, [user?.role]);

  const can = useCallback(
    (permission: Permission): boolean => {
      if (!isAuthenticated) return false;
      return permissionMatches(permissions, permission);
    },
    [permissions, isAuthenticated]
  );

  const canAny = useCallback(
    (requiredPermissions: Permission[]): boolean => {
      if (!isAuthenticated) return false;
      return requiredPermissions.some((p) => permissionMatches(permissions, p));
    },
    [permissions, isAuthenticated]
  );

  const canAll = useCallback(
    (requiredPermissions: Permission[]): boolean => {
      if (!isAuthenticated) return false;
      return requiredPermissions.every((p) => permissionMatches(permissions, p));
    },
    [permissions, isAuthenticated]
  );

  return {
    can,
    canAny,
    canAll,
    permissions,
    isAuthenticated,
  };
}
```

## Testing

- [ ] can() retorna true para permiso exacto
- [ ] can() retorna true para permiso con wildcard
- [ ] can() retorna false para permiso no asignado
- [ ] canAny() retorna true si tiene al menos uno
- [ ] canAny() retorna false si no tiene ninguno
- [ ] canAll() retorna true si tiene todos
- [ ] canAll() retorna false si falta alguno
- [ ] Retorna false para usuario no autenticado
