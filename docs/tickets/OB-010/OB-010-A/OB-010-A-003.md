# OB-010-A-003: Generar numero de radicado automatico

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-010 - Sistema de PQR |
| Story | OB-010-A - Modelo y creacion de PQR |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, radicado, secuencia |
| Depends on | OB-010-A-001 |
| Assigned | unassigned |

## Descripcion

Implementar generacion automatica de numeros de radicado unicos y secuenciales.

## Criterios de Aceptacion

- [ ] Formato: PQR-YYYY-NNNNN (ej: PQR-2025-00001)
- [ ] Secuencia por ano
- [ ] Garantizar unicidad con transaccion
- [ ] No debe haber gaps en la secuencia

## Notas de Implementacion

```typescript
async function generarRadicado(): Promise<string> {
  const year = new Date().getFullYear();

  // Usar transaccion para garantizar unicidad
  const result = await typeorm.$transaction(async (tx) => {
    const ultimo = await tx.pQR.findFirst({
      where: {
        radicado: { startsWith: `PQR-${year}-` }
      },
      orderBy: { radicado: 'desc' }
    });

    let siguiente = 1;
    if (ultimo) {
      const numeroActual = parseInt(ultimo.radicado.split('-')[2]);
      siguiente = numeroActual + 1;
    }

    return `PQR-${year}-${siguiente.toString().padStart(5, '0')}`;
  });

  return result;
}
```

## Testing

- [ ] Radicados son unicos
- [ ] Secuencia es correcta
- [ ] Reinicia cada ano
