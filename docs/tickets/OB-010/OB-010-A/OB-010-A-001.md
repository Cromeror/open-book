# OB-010-A-001: Crear entidad PQR con TypeORM

## Metadata

| Campo | Valor |
|-------|-------|
| Epic | OB-010 - Sistema de PQR |
| Story | OB-010-A - Modelo y creacion de PQR |
| Status | pending |
| Priority | high |
| Created | 2025-12-31 |
| Updated | 2025-12-31 |
| Labels | task, entidad, typeorm |
| Depends on | OB-002-A-001 |
| Assigned | unassigned |

## Descripcion

Crear la entidad PQR con decoradores TypeORM con todos los campos necesarios para gestionar peticiones, quejas y reclamos.

## Criterios de Aceptacion

- [ ] Entidad PQR definida con decoradores TypeORM
- [ ] Enum TipoPQR: PETICION, QUEJA, RECLAMO
- [ ] Estados: RADICADA, EN_PROCESO, RESPONDIDA, CERRADA
- [ ] Campos: asunto, descripcion, tipo, estado, fechaLimite
- [ ] Relacion con User (solicitante)
- [ ] Hereda campos de auditoria de BaseEntity

## Notas de Implementacion

Entidad PQR con TypeORM:
```typescript
import { Entity, Column, ManyToOne, OneToMany, JoinColumn, Index } from 'typeorm';
import { BaseEntity } from './base.entity';
import { User } from './user.entity';
import { Copropiedad } from './copropiedad.entity';
import { PQRHistorial } from './pqr-historial.entity';

export enum TipoPQR {
  PETICION = 'PETICION',
  QUEJA = 'QUEJA',
  RECLAMO = 'RECLAMO',
}

export enum EstadoPQR {
  RADICADA = 'RADICADA',
  EN_PROCESO = 'EN_PROCESO',
  RESPONDIDA = 'RESPONDIDA',
  CERRADA = 'CERRADA',
}

@Entity('pqrs')
export class PQR extends BaseEntity {
  @Column({ unique: true })
  @Index()
  radicado: string; // PQR-2025-00001

  @Column({
    type: 'enum',
    enum: TipoPQR,
  })
  tipo: TipoPQR;

  @Column()
  asunto: string;

  @Column({ type: 'text' })
  descripcion: string;

  @Column({
    type: 'enum',
    enum: EstadoPQR,
    default: EstadoPQR.RADICADA,
  })
  estado: EstadoPQR;

  @Column({ nullable: true })
  categoria: string; // VISIBILIDAD, APORTE, OTRO

  @Column()
  @Index()
  userId: string;

  @ManyToOne(() => User)
  @JoinColumn({ name: 'userId' })
  user: User;

  @Column()
  @Index()
  copropiedadId: string;

  @ManyToOne(() => Copropiedad)
  @JoinColumn({ name: 'copropiedadId' })
  copropiedad: Copropiedad;

  @Column({ type: 'timestamp' })
  fechaLimite: Date;

  @Column({ type: 'timestamp', nullable: true })
  fechaRespuesta: Date;

  @Column({ type: 'text', nullable: true })
  respuesta: string;

  @Column({ nullable: true })
  respondidoPor: string;

  // Historial de estados
  @OneToMany(() => PQRHistorial, (h) => h.pqr)
  historial: PQRHistorial[];
}
```

## Testing

- [ ] Entidad se crea correctamente
- [ ] Radicado es unico
- [ ] Estados funcionan
